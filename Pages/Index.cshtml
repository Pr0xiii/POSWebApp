@page
@model IndexModel
@using Microsoft.AspNetCore.Identity
@inject SignInManager<IdentityUser> SignInManager
@inject UserManager<IdentityUser> UserManager
@{
    ViewData["Title"] = "Home page";
}

<div class="text-center">
    <h1 class="display-4">Beboo</h1>
    @if(SignInManager.IsSignedIn(User)) 
    {
      <div class="container-apps">
          <div class="row" id="apps-row">
              <div class="col app-item" draggable="true" data-id="3">
                  <a class="btn app-item-btn" asp-page="POS/SalesView">
                      <span class="bi bi-shop"></span> POS
                  </a>
              </div>
              <div class="col app-item" draggable="true" data-id="1">
                  <a class="btn app-item-btn" asp-page="Products/products">
                      <span class="bi bi-box-fill"></span> Products
                  </a>
              </div>
              <div class="col app-item" draggable="true" data-id="2">
                  <a class="btn app-item-btn" asp-page="Clients/Clients">
                      <span class="bi bi-person-video"></span> Clients
                  </a>
              </div>
              <div class="col app-item" draggable="true" data-id="3">
                  <a class="btn app-item-btn" asp-page="Privacy">
                      <span class="bi bi-gear"></span> Settings
                  </a>
              </div>
          </div>
      </div>
    }
    else 
    {
      <h3>What is Beboo and who made it ?</h3>
      <div class="presentation">
        <p class="description">Beboo is a portfolio application influenced by the Odoo application. First based for a POS application,
        this app might update with news applications in the future as I like to test and implement new things through my learning of ASP.NET.
        But who am I ? Hi ! Nice to meet you, I'm Jolan Dessoy. A belgian C# and .NET developer. Alongside my studies in Application Development, 
        I am strengthening my skills in object-oriented programming, graphical user interface design, and software architecture.
        My background has also led me to work with Python and HTML/CSS/JavaScript, allowing me to tackle a wide variety of projects.</p>
        <img class="my-image" src="https://media.licdn.com/dms/image/v2/D4E35AQGef4qPeJlfoA/profile-framedphoto-shrink_200_200/B4EZqxgbmZGUAY-/0/1763914660530?e=1766131200&v=beta&t=17IpVUXPzooQbZ_XGJ6aniNpy7znSDDuQ8Yx7DYHRz4" alt="me, Jolan Dessoy">
      </div>
      <div class="presonnal-footer">
        <h4>Check out my profiles</h4>
        <div class="personnal-links">
          <a class="link linkedin" href="https://www.linkedin.com/in/dessoy-jolan-dev/"><i class="link bi bi-linkedin"></i></a>
          <a class="link github" href="https://github.com/Pr0xiii"><i class="bi bi-github"></i></a>
        </div>
      </div>
    }
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const container = document.getElementById('apps-row');
  let dragged = null;

  // dragstart / dragend au container (délégué)
  container.addEventListener('dragstart', (e) => {
    const item = e.target.closest('.app-item');
    if (!item) return;
    dragged = item;
    item.classList.add('dragging');
    // nécessaire pour Firefox
    try { e.dataTransfer.setData('text/plain', item.dataset.id || ''); } catch (err) {}
    e.dataTransfer.effectAllowed = 'move';
  });

  container.addEventListener('dragend', () => {
    if (dragged) dragged.classList.remove('dragging');
    dragged = null;
  });

  container.addEventListener('dragover', (e) => {
    e.preventDefault();
    const after = getDragAfterElement(container, e.clientX);
    if (!dragged) return;
    if (after == null) container.appendChild(dragged);
    else container.insertBefore(dragged, after);
  });

  container.addEventListener('drop', (e) => {
    e.preventDefault();
    // Optionnel : sauvegarder l'ordre
    const order = Array.from(container.querySelectorAll('.app-item'))
                       .map(el => el.dataset.id);
    console.log('Nouvel ordre :', order);
  });

  function getDragAfterElement(container, x) {
    const draggableElements = [...container.querySelectorAll('.app-item:not(.dragging)')];
    let closest = null;
    let closestOffset = Number.NEGATIVE_INFINITY;
    for (const child of draggableElements) {
      const box = child.getBoundingClientRect();
      const offset = x - (box.left + box.width / 2);
      // on veut le premier enfant dont centre est à droite du curseur (offset < 0)
      if (offset < 0 && offset > closestOffset) {
        closestOffset = offset;
        closest = child;
      }
    }
    return closest;
  }
});
</script>